---
title: "病毒 摘要整理类 1"
date: 2022-08-30T21:48:02+08:00
draft: true
---

#### 随想

1.逃逸，病毒先期检测环境。

2.启动，特定环境下才启动，如有sql server，如有特定漏洞，代码检测（特定代码检测等）

== 探测属于典型特征但是要和正常软件的内容区别（检测是否正常，主动上报，和apt主动防御）、

提权！！！ 注入。

3.



### 第一篇

西电电院？恶意代码网络技术研究

##### 基础名词

僵尸网络，勒索软件，木马。

僵尸网络生命周期-通信机制（各类静默活动)

木马==控制目标计算机。

==注意，代码这里说是固定流程，实际可能已经添加ai或者环境变化判定了，统计特征--数据包大小，到达时间间隔，流持续时间，数据量等特征，==带监督的机器学习方式。

随机森林和流特征。

注意流特征。

目前恶意代码分析检测方式主要有三种：基于主机行为的检测方法、基于静态特征的检测方法、以及基于网络行为的检测方法[39]。

3） 

虚拟机检测：作为一种新的检测手段，虚拟机检测可以对经过变形技术处

理的恶意代码进行有效的检测，这种技术已经为安全软件生产商所广泛采用。文献[6]

中就描述了一种基于主机行为的恶意代码检测方法，通过监控主机的配置和异常行为，

可以有效地检测到恶意代码。但是由于主机信息随着操作系统的不同而不尽相同、且

环境较为复杂，所以难以有效的监控，因而这种恶意代码的检测方式的适应性较弱。

Gu 等人[9]设计了 BotHunter 系统，该系统通过分析恶意代码产生的网络数据包，

匹配数据包负载数据中的特征字符串的方式进行检测。之后依据同一僵尸网络内的僵

尸主机可能具有时空关联性和相似性，他们又提出了基于网络异常的检测系统来识别

僵尸网络命令与控制通信，该系统被称为 BotSniffer[8]。通过进一步的研究他们又开

发了 BotMiner[10]，该系统通过提取网络数据的统计特征（主要是数据量大小特征）然

后通过聚类的方法进行恶意代码网络流量的检测，这种检测方法在特征提取时不用关

心恶意代码网络通信所使用的网络协议以及僵尸网络的结构，具有较好的扩展性和适

应性，但精确度依然有待提高。

Zhao 等人在文献[12]中提出了一种基于流量行为（主要表现为时间间隔）分析的

僵尸网络活动检测方法，利用僵尸恶意代码周期性的和服务器进行网络通信的特点来

构建特征集再利用机器学习方法给网络流量行为分类来实现，但时间间隔特征受网络

环境的影响较大，进而影响模型的精确度。

Wang 等人[15]设计了一种模糊的基于模式的滤波算法以检测僵尸网络。具体来说，

这种检测方式是通过分析 DNS 查询（如无效 DNS 反应数）通过对恶意域名和 IP 地 

址的匹配进行。 

这里是用统计特征和防火墙的相像。

为了保持与 C&C 服务器之间的通信，需要建立一个隐蔽通道，目前使用最多的是 HTTP 或HTTPS 协议。基于 Web 的 C&C 命令与控制方式，将恶意的命令与控制行为伪装成正常的网页浏览活动，可以很好地伪装成一般网络的访问流量。

具备反调试、密码窃取、文件下载以及加密通信等多种能力

### 第二篇

电科，动态二进制分析技术。==恶意代码虚拟执行技术

目前的动态二进制分析技术有指令模拟器、程序调试、程序沙箱、虚拟机软

件。指令模拟器采用软件模拟 CPU 来进行指令执行，运行效率极低；程序调试需

要分析人员的全程参与，无法实现分析的自动化；程序沙箱强制隔离资源，容易

被检测到，在检测到沙箱后恶意代码会立即停止恶意行为；虚拟机软件解决了指

令模拟的效率问题，但由于面向的是 CPU 指令，因此虚拟机软件无法针对具体程

序进行监控分析

。蠕虫[13]，是指通过计算机网络进行自我

复制，达到消耗计算机系统资源和计算机网络资源的程序代码。

Rootkit[16]，是指一套允许入侵者侵入系统，能够收集同一

网络上其它主机的信息，并掩盖主机被入侵事实的工具集合。

![image-20220830222508858](https://res.cloudinary.com/dbzr1zvpf/image/upload/v1661869512/2022/08/85ea7736e9c483dcc7463abbfcebfcbd.webp)

为了确保自身代码必然能得到执行权，病毒最常用

的技术就是入口点改写技术，即把 PE 头部中原来的执行入口先保存起来，然后

修改为嵌入到宿主文件中的自身代码。当系统运行宿主文件时，取得的入口点就

指向病毒代码，因此宿主文件执行会首先执行病毒的代码。病毒代码在执行后选

择适当的时机转入执行保存的原始入口，从而确保宿主能正常执行原来的功能。 

程序溢出技术[19]，指通过修改程序数据存储器的内容来改变程序指令执行流

程的控制技术。现有计算机系统存储器结构分冯诺依曼结构和哈佛结构两类[20]。 

图 2-3 所示的冯诺依曼存储器结构中，程序指令存储器和数据存储器合并在一起，

数据存储器和指令存储器并没有实质上的隔离，对数据存储器的修改有可能会修

改指令存储器，这种间接修改指令存储器的技术即为程序溢出技术。图 2-4 所示

的哈佛存储器结构中，程序指令存储器和数据存储器在各自独立的物理部件中，

对数据存储器的修改不会干扰程序指令存储器的内容。

----

按溢出数据的类别可以把程序溢出技术可分为程序栈溢

出技术和程序堆溢出技术[21,22]，栈溢出在实际溢出攻击中占据主导地位（通过写出恶意代码来实现程序栈溢出攻击方式)。

函数调用返回地址覆盖是最普遍最直接的栈溢出，新的编译技术--堆栈

Cookie[25]对此已经做了很好的防御，新的整数越界、操作系统异常处理劫持、C++

对象虚函数指针覆盖[23,24]类型的栈溢出成为当前栈溢出攻击的热点。

== 程序隐藏。

文件隐藏，文件过滤驱动隐藏。

==注册表树隐藏

通过劫持返回的注册表数据隐藏。

通过解析内核的访问值，进行劫持隐藏。

端口隐藏--端口复用，在web上。在查询端口的函数处进行劫持。返回去掉隐藏的端口。网络是外部io非系统内核部分，加载过滤驱动拦截。



协议及端口隐藏--国内官方修改tcp/ip协议使得国内外不互联再通过协议转换过流量。这里私有传输和处理有最大权限。

---虚拟机部分



数据访问监控主要有 API HOOK、应用程序沙箱、虚拟机软件[47-49]三种

----

通过应用程序沙箱分析恶意代码可以监控到其对系统资源的访问，比如文件、

注册表、网络、磁盘、命名对象等，并且对这些系统资源的修改访问不会破坏系

统，可以直接在本地系统中运行。使用应用程序沙箱分析恶意代码最大的挑战是

如何确保恶意代码在沙箱环境中能正常执行，因为沙箱强制隔离了恶意代码对系

统资源的修改。只要沙箱规则不够完善，就有可能出现资源访问不同步，导致恶

意代码执行失败，无法监控到其正常运行时的数据访问。



---------

第三篇  恶意软件逃逸分析

![image-20220830232500652](https://res.cloudinary.com/dbzr1zvpf/image/upload/v1661873103/2022/08/0134a1501da3143caae0935bac436984.webp)



!!! 沙箱检测逃逸

![image-20220830234044955](https://res.cloudinary.com/dbzr1zvpf/image/upload/v1661874047/2022/08/f93aaf574fcce1f696bef08416b6039c.webp)



![image-20220831000457639](https://res.cloudinary.com/dbzr1zvpf/image/upload/v1661875500/2022/08/2538e021606beac5f73dd8b6bcdd79e8.webp)

注意，，这里不就是chaosmesh么。。。

![image-20220831003538729](https://res.cloudinary.com/dbzr1zvpf/image/upload/v1661877347/2022/08/31718a0ca2598eccb7635da7b916c61e.webp)

这里是一个常见的测试流程。

![image-20220831004033708](https://res.cloudinary.com/dbzr1zvpf/image/upload/v1661877638/2022/08/a3623d4dc23b31dcad2956c6b362baf8.webp)



----

动态分析的反沙箱对抗技术

![image-20220831014640268](https://res.cloudinary.com/dbzr1zvpf/image/upload/v1661881604/2022/08/3c05fddc5003514e722066c52d007a43.webp)

![image-20220831094703311](https://res.cloudinary.com/dbzr1zvpf/image/upload/v1661910437/2022/08/8c17e5dad50ca4e0e42c8cf502b9f341.webp)



内存镜像dump--静态内容

![image-20220831095936813](https://res.cloudinary.com/dbzr1zvpf/image/upload/v1661911189/2022/08/9e4a8baf122ff9062dc7dc0e58e1957e.webp)



考虑是否添加python的内容。https://cloud.tencent.com/developer/article/1652228



![image-20220902102125354](https://res.cloudinary.com/dbzr1zvpf/image/upload/v1662085290/2022/09/d6417a495a8d35725a685705cfaf5406.webp)

![image-20220902110634791](https://res.cloudinary.com/dbzr1zvpf/image/upload/v1662087996/2022/09/e460373e0326e8a62c7afb29e72c47e2.webp)

![image-20220902111149407](https://res.cloudinary.com/dbzr1zvpf/image/upload/v1662088311/2022/09/7beada56db793fb4de68da08a78fbb7c.webp)

![image-20220902113535307](https://res.cloudinary.com/dbzr1zvpf/image/upload/v1662089737/2022/09/3a530c2fb25e27a6ecc25e49247db3f3.webp)

![image-20220902114337210](https://res.cloudinary.com/dbzr1zvpf/image/upload/v1662090218/2022/09/fa891e746f0400ba9460d53e84fff085.webp)

![image-20220902124116038](https://res.cloudinary.com/dbzr1zvpf/image/upload/v1662093681/2022/09/8cbe6cd008f4f499bc214e08d54e56e1.webp)
